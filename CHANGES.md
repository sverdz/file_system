# –û—Å—Ç–∞–Ω–Ω—ñ –∑–º—ñ–Ω–∏ / Recent Changes

## 2025-11-07 - –û–Ω–æ–≤–ª–µ–Ω–Ω—è TUI —ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è Excel

### üé® –ù–æ–≤–∏–π –¥–µ—Ç–∞–ª—å–Ω–∏–π TUI Dashboard

**–ì—ñ–ª–∫–∞**: `claude/fix-inventory-write-error-011CUtrbwo6aUuzkFYeT48Pt`
**–ö–æ–º—ñ—Ç**: `77d8f7e`
**–§–∞–π–ª**: `app/live_tui.py` (+344 —Ä—è–¥–∫–∏)

#### –ù–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:

1. **–î–µ—Ç–∞–ª—å–Ω—ñ –ª–æ–≥–∏ –æ–±—Ä–æ–±–∫–∏**
   ```
   [‚úÖ][12:34:56][0x7F8A] document_2024.pdf
   ‚îú‚îÄ üìè 2.5 MB  ‚îÇ  üìÖ 15.01.2024 14:23  ‚îÇ  üîí SHA-256: a3f5c9...
   ‚îú‚îÄ üîç SCAN       [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%  [‚úì]
   ‚îú‚îÄ üìù EXTRACT    [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%  [‚úì]
   ‚îú‚îÄ ü§ñ CLASSIFY   [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%  [‚úì]
   ‚îÇ    ‚îî‚îÄ üí¨ "–§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –∑–≤—ñ—Ç –∑–∞ 2024 —Ä—ñ–∫"
   ‚îî‚îÄ üè∑Ô∏è  CATEGORY: –§—ñ–Ω–∞–Ω—Å–æ–≤—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ ‚Üí /sorted/finance/
   ```

2. **–°–µ–∫—Ü—ñ—è –ø–æ–º–∏–ª–æ–∫**
   - –û–∫—Ä–µ–º–∞ –ø–∞–Ω–µ–ª—å `‚ùå ERROR LOG`
   - –ü–æ–∫–∞–∑ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 5 –ø–æ–º–∏–ª–æ–∫
   - Traceback preview (–ø–µ—Ä—à—ñ 2 —Ä—è–¥–∫–∏)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è —è–∫—â–æ –Ω–µ–º–∞—î –ø–æ–º–∏–ª–æ–∫

3. **–î–≤–∞ —Ä–µ–∂–∏–º–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è**
   - **–î–µ—Ç–∞–ª—å–Ω–∏–π** (`_detailed_view=True`): 3 —Ñ–∞–π–ª–∏ –∑ –ø–æ–≤–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é
   - **–ö–æ–º–ø–∞–∫—Ç–Ω–∏–π** (`_detailed_view=False`): 6-10 —Ñ–∞–π–ª—ñ–≤ –≤ –æ–¥–Ω—É –ª—ñ–Ω—ñ—é

4. **–ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π layout**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—ñ–¥–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥ —Ä–æ–∑–º—ñ—Ä —Ç–µ—Ä–º—ñ–Ω–∞–ª—É
   - –î–∏–Ω–∞–º—ñ—á–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤ (–∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –≤–∏—Å–æ—Ç–∏)
   - –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è —Ç–∞ —Ä–æ–∑—Ç—è–≥—É–≤–∞–Ω–Ω—è –Ω–∞ –≤–µ—Å—å –µ–∫—Ä–∞–Ω

#### –ù–æ–≤—ñ –º–µ—Ç–æ–¥–∏ API:

```python
# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∑–∞–ø—É—Å–∫
tui.set_run_info(run_id="2025-11-07_17-20-03", root_path="/data/")

# –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ñ–∞–π–ª –∑ –¥–µ—Ç–∞–ª—è–º–∏
tui.finish_file(
    status="success",  # "success", "warning", "error", "processing"
    category="–§—ñ–Ω–∞–Ω—Å–æ–≤—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏",
    message="–£—Å–ø—ñ—à–Ω–æ –∫–ª–∞—Å–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ",
    error_details=""
)

# –î–æ–¥–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É
tui.add_error(
    filename="scan_001.jpg",
    stage="extract",
    error_message="OCR failed",
    traceback="..."
)

# –ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ä–µ–∂–∏–º –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
tui.toggle_detailed_view()
```

#### –Ü–∫–æ–Ω–∫–∏:

- **–°—Ç–∞—Ç—É—Å–∏**: ‚úÖ success, ‚ö†Ô∏è warning, ‚ùå error, ‚öôÔ∏è processing
- **–ï—Ç–∞–ø–∏**: üîç scan, üìù extract, ü§ñ classify, ‚úèÔ∏è rename, üìã inventory

---

### üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è Excel –ø–æ–º–∏–ª–∫–∏

**–ö–æ–º—ñ—Ç**: `50540e5`
**–§–∞–π–ª**: `app/inventory.py` (+53 —Ä—è–¥–∫–∏)

#### –ü—Ä–æ–±–ª–µ–º–∞:
```
–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Å—É —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—ó: –ê–ù–î–†–Ü–ô –ì–†–ò–¶–ï–í–ò–ß –ê–∫—Ç–∏–≤–Ω–∏–π, –∫—Ä–µ–∞—Ç–∏–≤–Ω–∏–π...
cannot be used in worksheets.
```

#### –†—ñ—à–µ–Ω–Ω—è:

–î–æ–¥–∞–Ω–æ —Å–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—é –¥–ª—è Excel:

```python
def sanitize_cell_value(value: any) -> any:
    """
    –°–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—è –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –∑–∞–ø–∏—Å—É –≤ –∫–ª—ñ—Ç–∏–Ω–∫—É Excel.

    Excel –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î:
    - –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ —Å–∏–º–≤–æ–ª–∏ (ASCII 0-31, –∫—Ä—ñ–º TAB, LF, CR)
    - –¢–µ–∫—Å—Ç –¥–æ–≤—à–∏–π –∑–∞ 32,767 —Å–∏–º–≤–æ–ª—ñ–≤
    """
    if not isinstance(value, str):
        return value

    # –í–∏–¥–∞–ª–∏—Ç–∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ñ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ —Å–∏–º–≤–æ–ª–∏
    cleaned = EXCEL_INVALID_CHARS.sub('', value)

    # –û–±—Ä—ñ–∑–∞—Ç–∏ –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó –¥–æ–≤–∂–∏–Ω–∏
    if len(cleaned) > MAX_CELL_LENGTH:
        cleaned = cleaned[:MAX_CELL_LENGTH - 3] + "..."

    return cleaned
```

#### –©–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ:

- ‚úÖ –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤ ASCII 0-31 (–∫—Ä—ñ–º TAB, LF, CR)
- ‚úÖ –û–±—Ä—ñ–∑–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –¥–æ 32,767 —Å–∏–º–≤–æ–ª—ñ–≤ (–ª—ñ–º—ñ—Ç Excel)
- ‚úÖ –°–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—è –≤—Å—ñ—Ö —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ –≤ DataFrame
- ‚úÖ –°–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—è summary DataFrame
- ‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–µ-—Å—Ç—Ä–æ–∫–æ–≤–∏—Ö –∑–Ω–∞—á–µ–Ω—å –±–µ–∑ –∑–º—ñ–Ω

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–º—ñ–Ω

| –§–∞–π–ª | –î–æ–¥–∞–Ω–æ | –í–∏–¥–∞–ª–µ–Ω–æ | –í—Å—å–æ–≥–æ |
|------|--------|----------|--------|
| `app/live_tui.py` | +344 | -21 | 323 |
| `app/inventory.py` | +53 | -1 | 52 |
| **–í–°–¨–û–ì–û** | **+397** | **-22** | **375** |

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç TUI:
```bash
python3 test_tui_demo.py
```

### –¢–µ—Å—Ç Excel sanitization:
```bash
python3 test_excel_sanitize.py
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É:
```bash
git status
git log --oneline -3
```

---

## üìù –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```python
from app.live_tui import LiveTUI
from app.inventory import sanitize_cell_value

# TUI Dashboard
tui = LiveTUI()
tui.set_run_info(run_id="2025-11-07_17-20-03", root_path="/data/")
tui.start(total_files=47)

# –û–±—Ä–æ–±–∫–∞ —Ñ–∞–π–ª—É
tui.start_file("document.pdf", size_bytes=2500000, sha256="a3f5c9...")
tui.update_current_file_stage("classify", 100)
tui.finish_file(status="success", category="–§—ñ–Ω–∞–Ω—Å–∏")

# Excel —Å–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—è
clean_text = sanitize_cell_value("–¢–µ–∫—Å—Ç –∑\x00–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–º–∏\x01—Å–∏–º–≤–æ–ª–∞–º–∏")
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "–¢–µ–∫—Å—Ç –∑–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–º–∏—Å–∏–º–≤–æ–ª–∞–º–∏"
```

---

## ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞

–í—Å—ñ –∑–º—ñ–Ω–∏ –∑–∞–∫–æ–º—ñ—á–µ–Ω—ñ —Ç–∞ pushed:
- ‚úÖ Branch: `claude/fix-inventory-write-error-011CUtrbwo6aUuzkFYeT48Pt`
- ‚úÖ Commit 1: `50540e5` - Excel fix
- ‚úÖ Commit 2: `77d8f7e` - TUI redesign
- ‚úÖ Status: Up to date with origin
- ‚úÖ Working tree: Clean

---

**–ê–≤—Ç–æ—Ä**: Claude
**–î–∞—Ç–∞**: 2025-11-07
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ —ñ pushed
